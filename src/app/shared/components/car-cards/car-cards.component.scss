:host {
  position: relative;
  display: inline;
}

.car-cards-trigger {
  cursor: pointer;
  color: var(--color-text-secondary);
  outline: none;
  border-radius: 2px;

  &:focus-visible {
    outline: 2px solid var(--color-text-secondary);
    outline-offset: 2px;
  }
}

.tooltip {
  position: absolute;
  bottom: calc(100% + 12px);
  left: 50%;
  transform: translateX(-50%) translateY(250px);
  z-index: 1000;

  display: flex;
  gap: 12px;

  opacity: 0;

  visibility: hidden;
  pointer-events: none;

  // Exit: opacity first, then transform (both after cards collapse)
  transition:
    opacity var(--duration-standard) var(--ease-out-quart) var(--duration-fast),
    transform var(--duration-standard) var(--ease-out-quart)
      calc(var(--duration-fast) + var(--duration-micro)),
    visibility 0ms calc(var(--duration-fast) + var(--duration-standard));
}

.tooltip-visible {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
  transform: translateX(-50%) translateY(0);

  // Entry: transform first, opacity follows with small delay
  transition:
    opacity var(--duration-standard) var(--ease-out-quart) var(--duration-micro),
    transform var(--duration-standard) var(--ease-out-quart),
    visibility 0ms;
}

.tooltip-align-left {
  left: 0;
  transform: translateX(0);

  &.tooltip-visible {
    transform: translateX(0) translateY(0);
  }
}

.tooltip-align-right {
  left: auto;
  right: 0;
  transform: translateX(0);

  &.tooltip-visible {
    transform: translateX(0) translateY(0);
  }
}

.tooltip-item {
  display: flex;
  flex-direction: column;
  width: 180px;
  height: 220px;
  padding: 5px;
  background: var(--color-bg);
  border: 1px solid var(--color-hover);
  border-radius: 8px;

  box-shadow:
    0 4px 6px -1px rgb(0 0 0 / 0.1),
    0 2px 4px -2px rgb(0 0 0 / 0.1);
  transition: transform var(--duration-fast) var(--ease-out-quart);

  // Tooltip item should start animating just before tooltip is finished animating
  --tooltip-item-delay: var(--duration-fast);

  &:hover {
    cursor: pointer;
    transform: scale(1.05);
  }

  &:active {
    transform: scale(0.95);
  }

  &:nth-of-type(2) {
    position: absolute;
    left: 0;
    top: 0;
    z-index: -1;
    transform: rotate(0);

    // Exit: no delay, cards collapse immediately
    transition:
      left var(--duration-fast) var(--ease-out-quart),
      top var(--duration-fast) var(--ease-out-quart),
      transform var(--duration-fast) var(--ease-out-quart);

    .tooltip-visible & {
      left: -80px;
      top: 10px;
      transform: rotate(-7.5deg);

      // Entry: delay so cards fan out after tooltip appears
      transition:
        left var(--duration-fast) var(--ease-out-quart) var(--tooltip-item-delay),
        top var(--duration-fast) var(--ease-out-quart) var(--tooltip-item-delay),
        transform var(--duration-fast) var(--ease-out-quart) var(--tooltip-item-delay);

      &:hover {
        left: -120px;
        top: 0;
        transform: rotate(-15deg) scale(1.05);
      }

      &:active {
        transform: rotate(-15deg) scale(0.95);
      }
    }
  }

  &:nth-of-type(3) {
    position: absolute;
    right: 0;
    top: 0;
    z-index: -1;
    transform: rotate(0);

    // Exit: no delay, cards collapse immediately
    transition:
      right var(--duration-fast) var(--ease-out-quart),
      top var(--duration-fast) var(--ease-out-quart),
      transform var(--duration-fast) var(--ease-out-quart);

    .tooltip-visible & {
      right: -80px;
      top: 10px;
      transform: rotate(7.5deg);

      // Entry: delay so cards fan out after tooltip appears
      transition:
        right var(--duration-fast) var(--ease-out-quart) var(--tooltip-item-delay),
        top var(--duration-fast) var(--ease-out-quart) var(--tooltip-item-delay),
        transform var(--duration-fast) var(--ease-out-quart) var(--tooltip-item-delay);

      &:hover {
        right: -120px;
        top: 0;
        transform: rotate(15deg) scale(1.05);
      }

      &:active {
        transform: rotate(15deg) scale(0.95);
      }
    }
  }
}

.tooltip-image {
  width: 100%;
  height: 130px;
  border-radius: 4px;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.tooltip-content {
  text-align: center;
  text-wrap: pretty;

  user-select: none;
}

@media (prefers-reduced-motion: reduce) {
  .tooltip {
    transition: none;
  }

  .tooltip-item {
    transition: none;
  }
}
